# Vocabulary Specification

## Overview

This specification defines the structure and integration strategy for the [NHS dm+d (dictionary of medicines and devices)](https://isd.digital.nhs.uk/trud/users/authenticated/filters/0/home) vocabulary, which serves as a comprehensive dictionary of medicinal products and medical devices in the UK healthcare system, within the OMOP CDM and OHDSI Standardized Vocabularies framework. It covers the source and structure of the vocabulary, transformation and normalization processes required for OMOP compliance, mapping strategies to external terminologies such as SNOMED CT, RxNorm/RxNorm Extension, and CVX, as well as guidance for ETL implementation. Known limitations are addressed, along with recommendations for governance, maintenance, and future enhancements.

## Source Description

The dm+d vocabulary is primarily distributed as a set of XML files. These files contain the data representing the core dm+d concept classes:

|Concept Class|Description|
|---|---|
|Virtual Therapeutic Moiety (VTM) | Represents the active substance(s) of a medicinal product.|
|Virtual Medicinal Product (VMP) | Represents a medicinal product as it is marketed, described by its VTM(s), strength, and pharmaceutical form.|
|Virtual Medicinal Product Pack (VMPP) | Represents a pack containing one or more AMPs, defined by the included AMPs and their quantities.|
|Actual Medicinal Product (AMP) | Represents a specific presentation of a VMP, including pack size, route of administration, and manufacturer.|
|Actual Medicinal Product Pack (AMPP) | Represents a specific, marketed pack of a medicinal product with a unique identifier, containing one or more AMPs from a specific manufacturer.|

## Structure of Vocabulary

The dm+d structure includes five distinct concept classes (Virtual Therapeutic Moiety, Virtual Medicinal Product, Actual Medicinal Product, Virtual Medicinal Product Pack, and Actual Medicinal Product Pack), allowing for various levels of granularity to suit different use cases. It is regularly updated and plays a crucial role in improving patient safety, reducing transcription errors, and facilitating data analysis in UK healthcare. Brief overview of existing concept classes listed below:

## Source Description

#### Source Files

While downloaded, the data for dm+d vocabulary are primarily distributed as a **set of eight XML files**. These files contain the data for the core dm+d concept classes as outlined in the Structure. 

#### Files Overview

Brief overview of downloaded files listed below:

|||
|---|---|
|f_amp2.xml | Contains data for Actual Medicinal Products (AMPs). |
|f_ampp2.xml | Contains data for Actual Medicinal Product Packs (AMPPs). |
|f_ingredient2.xml | Contains information about ingredients and their relationships to Virtual Therapeutic Moieties (VTMs). |
|f_lookup2.xml | Contains various lookup tables and supporting codes used within the dm+d. |
|f_vmp2.xml | Contains data for Virtual Medicinal Products (VMPs). |
|f_vmpp2.xml | Contains data for Virtual Medicinal Product Packs (VMPPs). |
|f_vtm2.xml | Contains data for Virtual Therapeutic Moieties (VTMs). |
|f_history | Contains data for Historical Codes. |

#### Naming
The naming convention for these files follows a consistent pattern: `f_[entity_abbreviation]2.xml`. 

#### Data Format

The primary data format utilized is `Extensible Markup Language (XML)`. Each XML file corresponds to a specific entity type and contains a root element that defines this type. For example, a file containing VTM data will use `<VIRTUAL_THERAPEUTIC_MOIETIES>` as its root element. This root element encapsulates one or more `<VTM>` XML elements, each representing an individual record of a Virtual Therapeutic Moiety and its associated data values enclosed between the opening and closing tags.

    <?xml version="1.0" encoding="utf-8" ?>
    <VIRTUAL_THERAPEUTIC_MOIETIES xsi:noNamespaceSchemaLocation="vtm_v2_3.xsd"
    	xmlns=""
    	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  >
    	<!-- Generated by NHSBSA PPD -->
    	<VTM>
    		<VTMID>774405009</VTMID>
    		<NM>Acebutolol</NM>
    		<VTMIDPREV>68088000</VTMIDPREV>
    		<VTMIDDT>2023-02-06</VTMIDDT>
    	</VTM>
    	<VTM>
    		<VTMID>777067000</VTMID>
    		<NM>Paracetamol</NM>
    		<VTMIDPREV>90332006</VTMIDPREV>
    		<VTMIDDT>2023-02-06</VTMIDDT>
    	</VTM>
    	<VTM>
        ...

The table below provides a detailed description of each entity (XML element) found within a `<VTM>` record:

|Entity|Value|Descritpion|
|---|---|---|
|`<VTMID>`|774405009|A unique, persistent identifier assigned to the Virtual Therapeutic Moiety (VTM). This ID uniquely identifies the active ingredient or combination of active ingredients|
|`<NM>`|Acebutolol|The descriptive name of the VTM. This represents the common nomenclature for the active ingredient or combination|
|`<VTMIDPREV>`|68088000|An optional field indicating a previous unique identifier for the same VTM. This is utilized when a VTM's ID has been superseded, retired, or otherwise changed, facilitating historical data linkage.|
|`<VTMIDDT>`|2023-02-06|The date on which the current `<VTMID>` became effective or was last updated for this specific VTM record. This timestamp is crucial for managing data validity and versioning.|